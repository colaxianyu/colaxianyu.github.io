<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/uploads/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16-next.png">
  <link rel="mask-icon" href="/uploads/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.css" integrity="sha256-zM8WXtG4eUn7dKKNMTuoWZub++VnSfaOpA/8PJfvTBo=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"colaxianyu.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.23.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false,"trigger":"auto"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="也算是一边看文档和各种教程，一边用蓝图做了一个简单的demo出来，不过还是感觉很多东西的云里雾里的，正好打算把部分蓝图内容转换为C++实现，所以趁这个机会记录一下 PaperCharacter 地图的制作感觉可以先放一放，因为整个流程还是比较简单的，主要就是素材的导入，给必要的Tile添加碰撞，然后自由组合即可，等后续需要和角色产生交互再统一记录吧，所以这里就先记录一下角色制作的一些关键流程">
<meta property="og:type" content="article">
<meta property="og:title" content="UE5之横版2D游戏(一)">
<meta property="og:url" content="https://colaxianyu.github.io/2025/05/29/2025-05-29-UE5%E4%B9%8B%E6%A8%AA%E7%89%882D%E6%B8%B8%E6%88%8F(%E4%B8%80)/index.html">
<meta property="og:site_name" content="Colaxy&#39;s Blog">
<meta property="og:description" content="也算是一边看文档和各种教程，一边用蓝图做了一个简单的demo出来，不过还是感觉很多东西的云里雾里的，正好打算把部分蓝图内容转换为C++实现，所以趁这个机会记录一下 PaperCharacter 地图的制作感觉可以先放一放，因为整个流程还是比较简单的，主要就是素材的导入，给必要的Tile添加碰撞，然后自由组合即可，等后续需要和角色产生交互再统一记录吧，所以这里就先记录一下角色制作的一些关键流程">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-05-29T06:21:59.000Z">
<meta property="article:modified_time" content="2025-06-09T06:46:20.166Z">
<meta property="article:author" content="Colaxy">
<meta property="article:tag" content="C++,Reverse Engineering,Algorithm">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://colaxianyu.github.io/2025/05/29/2025-05-29-UE5%E4%B9%8B%E6%A8%AA%E7%89%882D%E6%B8%B8%E6%88%8F(%E4%B8%80)/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://colaxianyu.github.io/2025/05/29/2025-05-29-UE5%E4%B9%8B%E6%A8%AA%E7%89%882D%E6%B8%B8%E6%88%8F(%E4%B8%80)/","path":"2025/05/29/2025-05-29-UE5之横版2D游戏(一)/","title":"UE5之横版2D游戏(一)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>UE5之横版2D游戏(一) | Colaxy's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-189780915-2"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-189780915-2","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js" defer></script>








  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.js" integrity="sha256-hiUEBwFEpLF6DlB8sGXlKo4kPZ46Ui4qGpd0vrVkOm4=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Colaxy's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-ue5"><a href="/categories/ue5/" rel="section"><i class="fa fa-gamepad fa-fw"></i>UE5</a></li><li class="menu-item menu-item-c++"><a href="/categories/CPP/" rel="section"><i class="fa fa-coffee fa-fw"></i>C++</a></li><li class="menu-item menu-item-reverse"><a href="/categories/reverse/" rel="section"><i class="fa fa-bug fa-fw"></i>逆向</a></li><li class="menu-item menu-item-essay"><a href="/categories/essay/" rel="section"><i class="fa fa-pencil-ruler fa-fw"></i>随笔</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#papercharacter"><span class="nav-number">1.</span> <span class="nav-text">PaperCharacter</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#enhanced-input"><span class="nav-number">1.1.</span> <span class="nav-text">Enhanced Input</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#camera"><span class="nav-number">1.2.</span> <span class="nav-text">Camera</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.3.</span> <span class="nav-text">最终实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E6%9C%89%E6%84%8F%E6%80%9D%E7%9A%84%E8%AE%BE%E5%AE%9A"><span class="nav-number">2.</span> <span class="nav-text">一些有意思的设定</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Colaxy"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">Colaxy</p>
  <div class="site-description" itemprop="description">知行合一</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/colaxianyu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;colaxianyu" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://colaxianyu.github.io/2025/05/29/2025-05-29-UE5%E4%B9%8B%E6%A8%AA%E7%89%882D%E6%B8%B8%E6%88%8F(%E4%B8%80)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Colaxy">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Colaxy's Blog">
      <meta itemprop="description" content="知行合一">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="UE5之横版2D游戏(一) | Colaxy's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          UE5之横版2D游戏(一)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-05-29 14:21:59" itemprop="dateCreated datePublished" datetime="2025-05-29T14:21:59+08:00">2025-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-06-09 14:46:20" itemprop="dateModified" datetime="2025-06-09T14:46:20+08:00">2025-06-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ue5/" itemprop="url" rel="index"><span itemprop="name">ue5</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>也算是一边看文档和各种教程，一边用蓝图做了一个简单的demo出来，不过还是感觉很多东西的云里雾里的，正好打算把部分蓝图内容转换为C++实现，所以趁这个机会记录一下</p>
<h1 id="papercharacter">PaperCharacter</h1>
<p>地图的制作感觉可以先放一放，因为整个流程还是比较简单的，主要就是素材的导入，给必要的Tile添加碰撞，然后自由组合即可，等后续需要和角色产生交互再统一记录吧，所以这里就先记录一下角色制作的一些关键流程</p>
<h2 id="enhanced-input">Enhanced Input</h2>
<p>以前处理输入主要依赖于轴映射输入，但现在UE5更推荐使用<code>增强输入</code>来处理，个人的理解是<code>增强输入</code>可以解耦输入操作的逻辑，以组合的形式提高灵活性和复用性。不过我自己也没有详细了解过<code>增强输入</code>系统，所以就不展开介绍原理了，只简单记录一下如何使用</p>
<span id="more"></span>
<p>横板2D游戏的移动比较简单，最基础的就是左右移动和跳跃，所以就先从这两个最基础的Action开始，首先从InputMappingContext和InputAction创建IMC_Default、IA_Move和IA_Jump</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-28-3b10415744277ba3370f00933840d56b.png" /></p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-28-c58b2e5c0a17acee8eccadc1d1084c16.png" /></p>
<p>然后在IMC_Default中完成配置 <img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-28-c7ccea27fecb3f6c8106d3295274516f.png" /></p>
<p>接下来创建一个C++类用于表示游戏中的角色，这里暂时使用默认的Character，因为2D角色主要就是把骨骼组件改为成了Sprite，动画组件变为FlipBook，其余地方没有太多区别，而正式创建2D角色会用到PaperZD这个插件，所以就先用默认的Character展示</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-28-74f60b5be3177ac7d8f79d15c0ac0ba2.png" /></p>
<p>我们需要实现Move和Jump的逻辑，然后把相应的资源和逻辑载入到<code>输入增强</code>系统中，所以我们首先在头文件<code>CharacterBase.h</code>中声明相关变量和函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameFramework/Character.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CharacterBase.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UInputMappingContext</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UInputAction</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FInputActionValue</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TEST_API</span> ACharacterBase : <span class="keyword">public</span> ACharacter</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 添加输入映射上下文</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>)) </span><br><span class="line">	UInputMappingContext* InputMappingContext;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加Move动作</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">	UInputAction* MoveAction;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加Jump动作</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">	UInputAction* JumpAction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">// Sets default values for this character&#x27;s properties</span></span><br><span class="line">	<span class="built_in">ACharacterBase</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="comment">// Called when the game starts or when spawned</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BeginPlay</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:	</span><br><span class="line">	<span class="comment">// Called every frame</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Tick</span><span class="params">(<span class="type">float</span> DeltaTime)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Called to bind functionality to input</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">SetupPlayerInputComponent</span><span class="params">(<span class="keyword">class</span> UInputComponent* PlayerInputComponent)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">const</span> FInputActionValue&amp; Value)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>然后在<code>CharacterBase.cpp</code>中完成相关逻辑（这里已经在构造函数中调整了胶囊组件和骨骼组件的部分配置，也可以延迟到在蓝图子类中设置），简单来说</p>
<ul>
<li>对于<code>Move</code>函数，由于是2D游戏，我们只需要控制角色在水平方向移动即可，假设我们的角色在X轴上移动，那么我们就可以不用关心Y轴和Z轴</li>
<li>对于<code>Jump</code>函数，由于没有什么特殊需求，所以直接使用了默认的实现</li>
<li>最后，我们需要把Action和相应逻辑绑定，并加入到<code>增强输入</code>系统中</li>
</ul>
<p>下面是具体的代码 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fill out your copyright notice in the Description page of Project Settings.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CharacterBase.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EnhancedInputComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EnhancedInputSubsystems.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;InputActionValue.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Sets default values</span></span><br><span class="line">ACharacterBase::<span class="built_in">ACharacterBase</span>()</span><br><span class="line">&#123;</span><br><span class="line"> 	<span class="comment">// Set this character to call Tick() every frame.  You can turn this off to improve performance if you don&#x27;t need it.</span></span><br><span class="line">	PrimaryActorTick.bCanEverTick = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化胶囊组件</span></span><br><span class="line">	<span class="built_in">GetCapsuleComponent</span>()-&gt;<span class="built_in">InitCapsuleSize</span>(<span class="number">42.f</span>, <span class="number">96.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置骨骼网格组件并加载Asset</span></span><br><span class="line">	<span class="built_in">GetMesh</span>()-&gt;<span class="built_in">SetRelativeLocation</span>(<span class="built_in">FVector</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-90.0f</span>));</span><br><span class="line">	<span class="built_in">GetMesh</span>()-&gt;<span class="built_in">SetRelativeRotation</span>(<span class="built_in">FRotator</span>(<span class="number">0.0f</span>, <span class="number">-90.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	<span class="built_in">GetMesh</span>()-&gt;<span class="built_in">SetSkeletalMeshAsset</span>(<span class="built_in">LoadObject</span>&lt;USkeletalMesh&gt;(<span class="literal">nullptr</span>, <span class="built_in">TEXT</span>(<span class="string">&quot;/Script/Engine.SkeletalMesh&#x27;/Game/Characters/Mannequin_UE4/Meshes/SK_Mannequin.SK_Mannequin&#x27;&quot;</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Called when the game starts or when spawned</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ACharacterBase::BeginPlay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">BeginPlay</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Called every frame</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ACharacterBase::Tick</span><span class="params">(<span class="type">float</span> DeltaTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">Tick</span>(DeltaTime);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Called to bind functionality to input</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ACharacterBase::SetupPlayerInputComponent</span><span class="params">(UInputComponent* PlayerInputComponent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">SetupPlayerInputComponent</span>(PlayerInputComponent);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输入映射上下文</span></span><br><span class="line">	<span class="keyword">if</span> (APlayerController* PC = <span class="built_in">Cast</span>&lt;APlayerController&gt;(Controller)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (UEnhancedInputLocalPlayerSubsystem* Subsystem = ULocalPlayer::<span class="built_in">GetSubsystem</span>&lt;UEnhancedInputLocalPlayerSubsystem&gt;(PC-&gt;<span class="built_in">GetLocalPlayer</span>())) &#123;</span><br><span class="line">			Subsystem-&gt;<span class="built_in">AddMappingContext</span>(InputMappingContext, <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绑定输入动作</span></span><br><span class="line">	<span class="keyword">if</span> (UEnhancedInputComponent* EIComponent = <span class="built_in">Cast</span>&lt;UEnhancedInputComponent&gt;(PlayerInputComponent)) &#123;</span><br><span class="line">		EIComponent-&gt;<span class="built_in">BindAction</span>(MoveAction, ETriggerEvent::Triggered, <span class="keyword">this</span>, &amp;ACharacterBase::Move);</span><br><span class="line">		EIComponent-&gt;<span class="built_in">BindAction</span>(JumpAction, ETriggerEvent::Started, <span class="keyword">this</span>, &amp;ACharacterBase::Jump);</span><br><span class="line">		EIComponent-&gt;<span class="built_in">BindAction</span>(JumpAction, ETriggerEvent::Completed, <span class="keyword">this</span>, &amp;ACharacter::StopJumping);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移动逻辑</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ACharacterBase::Move</span><span class="params">(<span class="type">const</span> FInputActionValue&amp; Value)</span> </span>&#123;</span><br><span class="line">	FVector ForwardDirection = <span class="built_in">FVector</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line">	FVector2D MovementValue = Value.<span class="built_in">Get</span>&lt;FVector2D&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">AddMovementInput</span>(ForwardDirection, MovementValue.X);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>之后创建一个基于<code>CharacterBase</code>的蓝图类<code>BP_CharacterBase</code>，并添加之前制作好的IMC_Default、IA_Move和IA_Jump，因为我们没有用代码加载它们，所以需要手动设置一下（如果你之前没有用代码调整胶囊组件和骨骼组件的部分配置，那么也可以在这里设置）</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-6c1fb1e8285d5c561283cf66e552469d.png" /></p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-e0a5868bfab70a8302fde9e481d2231a.png" /></p>
<p>然后在GameMode中指定<code>BP_CharacterBase</code>为默认的Pawn</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AtestGameMode.h</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameFramework/GameModeBase.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;testGameMode.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>(minimalapi)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AtestGameMode</span> : <span class="keyword">public</span> AGameModeBase</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">AtestGameMode</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AtestGameMode.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;testGameMode.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;testCharacter.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UObject/ConstructorHelpers.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">AtestGameMode::<span class="built_in">AtestGameMode</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// set default pawn class to our Blueprinted character</span></span><br><span class="line">	<span class="function"><span class="type">static</span> ConstructorHelpers::FClassFinder&lt;APawn&gt; <span class="title">PlayerPawnBPClass</span><span class="params">(TEXT(<span class="string">&quot;/Game/ThirdPerson/Blueprints/BP_CharacterBase&quot;</span>))</span></span>;</span><br><span class="line">	<span class="keyword">if</span> (PlayerPawnBPClass.Class != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		DefaultPawnClass = PlayerPawnBPClass.Class;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后完成相关配置</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-384933105fe2dc75177ecfd96828fb8d.png" /></p>
<p>现在我们运行游戏，并选中角色以便观察位置的变化（此时还没有添加摄像机，所以看不到人物模型），然后按D试试能否移动</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-d5d15535e631519515c5da0e7fe7a24e.png" /></p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-2ce86aa440068ce626c7556291f4565e.png" /></p>
<p>可以观察到，只有X发生了变化，所以移动的逻辑暂时没有太大的问题，现在我们处理一下摄像机，以便我们可以更好的观察</p>
<h2 id="camera">Camera</h2>
<p>首先需要确定的是，我们的游戏是一个类似于<strong>冒险岛</strong>或<strong>空洞骑士</strong>的横版本2D游戏，所以摄像机应该从侧视角拍摄我们的角色，那么这里会用到两个关键的组件SpringArm和Camera</p>
<p>简单解释一下SpringArm是什么，大致可以把SpringArm看作成一个扛着摄像机的人，控制摄像机从什么位置，什么角度进行拍摄。这也能很好的解释为什么后续代码中，我们实现侧视角拍摄旋转的是SpringArm，而不是Camera本身</p>
<p>首先在<code>CharacterBase.h</code>中添加相应的组件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加SpringArm组件</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">USpringArmComponent* SpringArm;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加Camera组件</span></span><br><span class="line"><span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">UCameraComponent* Camera;</span><br></pre></td></tr></table></figure>
<p>然后在构造函数中完成初始化 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sets default values</span></span><br><span class="line">ACharacterBase::<span class="built_in">ACharacterBase</span>()</span><br><span class="line">&#123;</span><br><span class="line"> 	<span class="comment">// Set this character to call Tick() every frame.  You can turn this off to improve performance if you don&#x27;t need it.</span></span><br><span class="line">	PrimaryActorTick.bCanEverTick = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化胶囊组件</span></span><br><span class="line">	<span class="built_in">GetCapsuleComponent</span>()-&gt;<span class="built_in">InitCapsuleSize</span>(<span class="number">42.f</span>, <span class="number">96.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置骨骼网格组件并加载Asset</span></span><br><span class="line">	<span class="built_in">GetMesh</span>()-&gt;<span class="built_in">SetRelativeLocation</span>(<span class="built_in">FVector</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">-90.0f</span>));</span><br><span class="line">	<span class="built_in">GetMesh</span>()-&gt;<span class="built_in">SetRelativeRotation</span>(<span class="built_in">FRotator</span>(<span class="number">0.0f</span>, <span class="number">-90.0f</span>, <span class="number">0.0f</span>));</span><br><span class="line">	<span class="built_in">GetMesh</span>()-&gt;<span class="built_in">SetSkeletalMeshAsset</span>(<span class="built_in">LoadObject</span>&lt;USkeletalMesh&gt;(<span class="literal">nullptr</span>, <span class="built_in">TEXT</span>(<span class="string">&quot;/Script/Engine.SkeletalMesh&#x27;/Game/Characters/Mannequin_UE4/Meshes/SK_Mannequin.SK_Mannequin&#x27;&quot;</span>)));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建SpringArm和Camera组件，并加入到RootComponent中</span></span><br><span class="line">	SpringArm = <span class="built_in">CreateDefaultSubobject</span>&lt;USpringArmComponent&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;SpringArm&quot;</span>));</span><br><span class="line">	SpringArm-&gt;<span class="built_in">SetupAttachment</span>(RootComponent);</span><br><span class="line">	SpringArm-&gt;TargetArmLength = <span class="number">300.0f</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调整拍摄的角度，侧视角，并添加一定的俯视角</span></span><br><span class="line">	SpringArm-&gt;<span class="built_in">SetRelativeRotation</span>(<span class="built_in">FRotator</span>(<span class="number">-45</span>, <span class="number">-90</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建Camera组件，添加到SpringArm组件之下 </span></span><br><span class="line">	Camera = <span class="built_in">CreateDefaultSubobject</span>&lt;UCameraComponent&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;Camera&quot;</span>));</span><br><span class="line">	Camera-&gt;<span class="built_in">SetupAttachment</span>(SpringArm, USpringArmComponent::SocketName);</span><br><span class="line">	Camera-&gt;ProjectionMode = ECameraProjectionMode::Orthographic;</span><br><span class="line">	Camera-&gt;OrthoWidth = <span class="number">720.0f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-2f5b516142dd5dc890d8b76af4a39af4.png" /></p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-df3fbe29e6cf7128023c2ed4c5844ffb.png" /></p>
<p>现在基础的移动功能就完成了（跳跃其实也是正常的，不过视角问题，而且没有添加动画，所以不太明显）</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-1c64965855278ea624395648f64d46a6.png" /></p>
<h2 id="最终实现">最终实现</h2>
<p>由于使用的是第三人称模板，所以出于方便都是用的3D角色做的实验，现在正式使用PaperZD来实现2D角色(第三方插件)，创建一个继承自<code>PaperZDCharacter</code>的类<code>PaperCharacterBase</code></p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-55bd627fe02abd1b2e4a82f6b06e5114.png" /></p>
<p>代码方面变动不大，只需要把骨骼相关的内容删除即可，下面给出完整代码</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CoreMinimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PaperZDCharacter.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PaperCharacterBase.generated.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UInputMappingContext</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UInputAction</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">USpringArmComponent</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UCameraComponent</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FInputActionValue</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">UCLASS</span>()</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TEST_API</span> APaperCharacterBase : <span class="keyword">public</span> APaperZDCharacter</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">GENERATED_BODY</span>()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加输入映射上下文</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">	UInputMappingContext* InputMappingContext;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加Move动作</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">	UInputAction* MoveAction;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加Jump动作</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">	UInputAction* JumpAction;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加SpringArm组件</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">	USpringArmComponent* SpringArm;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 添加Camera组件</span></span><br><span class="line">	<span class="built_in">UPROPERTY</span>(EditAnywhere, BlueprintReadOnly, Category = Input, meta = (AllowPrivateAccess = <span class="string">&quot;true&quot;</span>))</span><br><span class="line">	UCameraComponent* Camera;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">APaperCharacterBase</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">BeginPlay</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Tick</span><span class="params">(<span class="type">float</span> DeltaTime)</span> <span class="keyword">override</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">SetupPlayerInputComponent</span><span class="params">(<span class="keyword">class</span> UInputComponent* PlayerInputComponent)</span> <span class="keyword">override</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">(<span class="type">const</span> FInputActionValue&amp; Value)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PaperCharacterBase.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EnhancedInputComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EnhancedInputSubsystems.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;InputActionValue.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Components/CapsuleComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Camera/CameraComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;GameFramework/SpringArmComponent.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PaperFlipbookComponent.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">APaperCharacterBase::<span class="built_in">APaperCharacterBase</span>()</span><br><span class="line">&#123;</span><br><span class="line">	PrimaryActorTick.bCanEverTick = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化胶囊组件</span></span><br><span class="line">	<span class="built_in">GetCapsuleComponent</span>()-&gt;<span class="built_in">InitCapsuleSize</span>(<span class="number">22.f</span>, <span class="number">40.0f</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建SpringArm和Camera组件，并加入到RootComponent中</span></span><br><span class="line">	SpringArm = <span class="built_in">CreateDefaultSubobject</span>&lt;USpringArmComponent&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;SpringArm&quot;</span>));</span><br><span class="line">	SpringArm-&gt;<span class="built_in">SetupAttachment</span>(RootComponent);</span><br><span class="line">	SpringArm-&gt;TargetArmLength = <span class="number">300.0f</span>;</span><br><span class="line">	SpringArm-&gt;<span class="built_in">SetRelativeRotation</span>(<span class="built_in">FRotator</span>(<span class="number">0</span>, <span class="number">-90</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建Camera组件，添加到SpringArm组件之下 </span></span><br><span class="line">	Camera = <span class="built_in">CreateDefaultSubobject</span>&lt;UCameraComponent&gt;(<span class="built_in">TEXT</span>(<span class="string">&quot;Camera&quot;</span>));</span><br><span class="line">	Camera-&gt;<span class="built_in">SetupAttachment</span>(SpringArm, USpringArmComponent::SocketName);</span><br><span class="line">	Camera-&gt;ProjectionMode = ECameraProjectionMode::Orthographic;</span><br><span class="line">	Camera-&gt;OrthoWidth = <span class="number">720.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Called when the game starts or when spawned</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">APaperCharacterBase::BeginPlay</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">BeginPlay</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Called every frame</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">APaperCharacterBase::Tick</span><span class="params">(<span class="type">float</span> DeltaTime)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">Tick</span>(DeltaTime);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Called to bind functionality to input</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">APaperCharacterBase::SetupPlayerInputComponent</span><span class="params">(UInputComponent* PlayerInputComponent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Super::<span class="built_in">SetupPlayerInputComponent</span>(PlayerInputComponent);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输入映射上下文</span></span><br><span class="line">	<span class="keyword">if</span> (APlayerController* PC = <span class="built_in">Cast</span>&lt;APlayerController&gt;(Controller)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (UEnhancedInputLocalPlayerSubsystem* Subsystem = ULocalPlayer::<span class="built_in">GetSubsystem</span>&lt;UEnhancedInputLocalPlayerSubsystem&gt;(PC-&gt;<span class="built_in">GetLocalPlayer</span>())) &#123;</span><br><span class="line">			Subsystem-&gt;<span class="built_in">AddMappingContext</span>(InputMappingContext, <span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 绑定输入动作</span></span><br><span class="line">	<span class="keyword">if</span> (UEnhancedInputComponent* EIComponent = <span class="built_in">Cast</span>&lt;UEnhancedInputComponent&gt;(PlayerInputComponent)) &#123;</span><br><span class="line">		EIComponent-&gt;<span class="built_in">BindAction</span>(MoveAction, ETriggerEvent::Triggered, <span class="keyword">this</span>, &amp;APaperCharacterBase::Move);</span><br><span class="line">		EIComponent-&gt;<span class="built_in">BindAction</span>(JumpAction, ETriggerEvent::Started, <span class="keyword">this</span>, &amp;APaperCharacterBase::Jump);</span><br><span class="line">		EIComponent-&gt;<span class="built_in">BindAction</span>(JumpAction, ETriggerEvent::Completed, <span class="keyword">this</span>, &amp;APaperCharacterBase::StopJumping);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 移动逻辑</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">APaperCharacterBase::Move</span><span class="params">(<span class="type">const</span> FInputActionValue&amp; Value)</span> </span>&#123;</span><br><span class="line">	FVector ForwardDirection = <span class="built_in">FVector</span>(<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line">	FVector2D MovementValue = Value.<span class="built_in">Get</span>&lt;FVector2D&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">AddMovementInput</span>(ForwardDirection, MovementValue.X);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的，需要创建一个继承自<code>PaperCharacterBase</code>的蓝图类<code>BP_PaperCharacterBase</code>，并在GameMode中把默认Pawn修改过来</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-b51088f699a79fcb35210809fe4fe45a.png" /></p>
<p>最后看一下效果（这里我只设置了侧视角，没有设置俯视角）</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-0e44123892884215162151a48d250518.gif" /></p>
<h1 id="一些有意思的设定">一些有意思的设定</h1>
<p>回到默认的第三人称模板（把GameMode中默认Pawn改回去就行），在调设置的时候发现了几个有意思的设定，分别是角色移动组件里的<code>使用控制器所需的旋转(bUseControllerDesiredRotation)</code>和<code>将旋转朝向运动(bOrientRotationToMovement)</code>、Self里的<code>使用控制器旋转YAW(bUseControllerRotationYaw)</code></p>
<p>如果以上3个选项都不勾选，那么角色的朝向是永远是初始化到游戏场景中的朝向（如果你可以通过某种方式改变控制器正方向的朝向，那么此时，控制器的朝向和角色的朝向是分离的）</p>
<p>例如最开始移动时，角色朝向和控制器正方向是一致的，按<code>W</code>可以往前走。由于第三人称模板提供了<code>IA_Look</code>，可以用鼠标改变控制器的正方向的朝向，所以当我移动鼠标，角色就开始朝不同的方向移动，即使整个过程都只按了<code>W</code>键</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-9dcc4d696424da379b937779d0aa7729.gif" /></p>
<p>将控制器和角色朝向关联起来的关键就是这三个设置，其中<code>使用控制器所需的旋转</code>或<code>使用控制器旋转YAW</code>二者的功能是一致的，当勾选之后，角色朝向会和控制器的正方向绑定</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-85af89577378536ee4ef4a4282ee05ac.png" /></p>
<p>当我移动鼠标时，角色朝向总是与控制器的正方向一致，这就保证了，按下<code>W</code>时总是往角色朝向的方位运动</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-8876a016a2db4fb7e247ab24ba76e757.gif" /></p>
<p>那么<code>使用控制器所需的旋转</code>和<code>使用控制器旋转YAW</code>有什么区别呢，在<code>使用控制器所需的旋转</code>的描述中有提到</p>
<blockquote>
<p>如果该选项为true，那么会应用RotationRate以平滑的旋转，会被<code>将旋转朝向运动</code>这一选项覆盖，并且需要取消勾选<code>使用控制器旋转YAW</code></p>
</blockquote>
<p>我们勾选<code>使用控制器所需的旋转</code>，然后把<code>旋转速率</code>降低</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-eac9a8c9ed7cb3866111a8eb671cf186.png" /></p>
<p>可以看到旋转的速度是比较缓慢的，尽管我早就已经用鼠标完成了转动的操作</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-e552219050676f781dc53d672b8d8fe7.gif" /></p>
<p>由于勾选<code>使用控制器旋转YAW</code>会覆盖掉这些设置，且功能一致，所以就不单独测试了，接下来直接看<code>将旋转朝向运动</code>的功能即可</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-4110216b277ced9a844111e2903d0b05.png" /></p>
<p>这个功能并不会将角色的朝向和控制器的正方向绑定(即移动鼠标角色的朝向不会改变)，但它会让角色<strong>运动时</strong>旋转到运动的方向，可以看到，在我不改变控制器朝向时，分别按下<code>W</code>、<code>D</code>、<code>A</code>，可以观察到角色的朝向改变了（注意这个选项会覆盖掉<code>使用控制器所需的旋转</code>的功能，即控制器的正方向可以改变，但人物朝向不变）</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-c395e589bcd32bd7ec104a05c6e017d8.gif" /></p>
<p>同样的，如果想使用这个功能，应该取消勾选<code>使用控制器旋转YAW</code></p>
<p>简单总结一下</p>
<ul>
<li><code>使用控制器所需的旋转</code>和<code>使用控制器旋转YAW</code>是把角色朝向和控制器正方向绑定<br />
</li>
<li><code>将旋转朝向运动</code>是在运动时改变角色朝向，将其和实际运动的方向绑定</li>
</ul>
<p>你可能会好奇，第三人称模板不应该是移动鼠标然后旋转摄像机的视角吗，怎么我这里移动鼠标只能改变控制器在水平方向上的旋转，摄像机总是拍摄角色的背部，这就是最后一个设定，SpringArm中的<code>使用Pawn控制旋转(bUsePawnControlRotation)</code></p>
<p>我们先把之前的几个设定取消勾选，然后开启<code>使用Pawn控制旋转</code>，<strong>注意，虽然这里写的是摄像机设置，但实际是SpringArm中的选项，而不是摄像机中的（摄像机也有相同的选项）</strong></p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-11ff0c1aec02318f97ff9d4d2804c9a0.png" /></p>
<p>当然，由于关闭了之前的三个选项，所以控制器的正方向和角色朝向不是一致的</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-29-193ff3d18896f3ccf349727d8ad30997.gif" /></p>
<p>所以要实现正确的第三人称视角就有两种组合，<code>使用Pawn控制旋转 + 使用控制器所需的旋转</code>和<code>使用Pawn控制旋转 + 将旋转朝向运动</code>，它们的区别就在于朝不同的方向移动时，角色是否会面向这个方向</p>
<p>简单看一下效果，首先是<code>Pawn控制旋转 + 使用控制器所需的旋转</code>组合，可以看到，角色朝向会随着我移动鼠标变化，但当我按<code>A</code>和<code>D</code>时，角色并没有转向运动的方向，但如果我只按<code>W</code>，用鼠标改变控制器正方向时，一切都很正常，因为此时角色的朝向与控制器的正方向绑定，所以OK</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-30-7563cb8ddcb4fd5c0169071ffee07813.gif" /></p>
<p>现在我们看看<code>Pawn控制旋转 + 将旋转朝向运动</code>的组合，最大的区别就在于，不产生运动时，角色的朝向并不会改变，但我按<code>A</code>和<code>D</code>时，角色会转向运动的方向，并且最后我只按<code>W</code>，用鼠标改变控制器正方向时，也是正常的，所以这个组合可以看作一个满血的第三人称控制，那么<code>Pawn控制旋转 + 使用控制器所需的旋转</code>组合有什么用途呢，假设我们的游戏提供了一个AutoRun的功能，此时玩家便无需按<code>W、A、S、D</code>控制角色运动，只需要移动鼠标控制方向即可</p>
<p><img data-src="https://raw.githubusercontent.com/colaxianyu/imgbed/master/img/2025-05-30-12-33-d9f9bde713d61dbf79d01a58ecdfab8c.gif" /></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/05/23/2025-05-23-cpp20%E5%AD%A6%E4%B9%A0%E4%B9%8Bmodule/" rel="prev" title="C++20学习之module">
                  <i class="fa fa-angle-left"></i> C++20学习之module
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/06/06/2025-06-06-%E8%AE%B0%E4%B8%80%E4%B8%AADP%E7%AE%97%E6%B3%95/" rel="next" title="记一个DP算法">
                  记一个DP算法 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2021 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Colaxy</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
