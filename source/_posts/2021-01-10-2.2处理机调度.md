---
title: 处理机调度
date: 2021-01-28 22:45:47
categories: 
    - 考研
---

### 处理机调度的概念与层次

#### 基本概念

- 按照某种算法选择一个进程将处理机分配给该进程

#### 层次

1. 高级调度(作业调度)
   - 按一定规则，从外存中挑选处于后备队列的作业调入内存，并为其创建进程
2. 中级调度(内存调度，内存管理中的**交换技术**)
   - 按一定规则，从外存中挑选挂起队列中的就绪进程调回内存，并加入就绪队列中，反之，暂时不能运行的进程将调至外存挂起
3. 低级调度(进程调度)
   - 按照某种规则，从就绪队列中选择一个进程并分配处理机

<!--more-->

#### 三层调度的对比与联系

1. 高级调度
   - 外存 -> 内存（对于作业）
   - 发生频率：最低
2. 中级调度
   - 外存 -> 内存、内存 -> 外存（对于进程）
   - 发生频率：中等
3. 低级调度
   - 内存 -> CPU
   - 发生频率：高

#### 补充内容

1. 为提高内存利用率与系统吞吐量，暂时不能运行的进程会调至外存等待，即**挂起态**
2. 七状态模型，在五状态模型的基础上加入了“**就绪挂起**”、“**阻塞挂起**”两种状态

---

### 调度的时机、切换与过程以及方式

#### 进程何时发生调度

1. 主动放弃
   - 进程正常终止
   - 运行过程中发生异常而终止
   - 主动阻塞
2. 被动放弃
   - 时间片用完
   - 优先级更高的进程进入就绪队列
   - 有更紧急的事情需要处理（如IO中断）

#### 进程何时不允许发生调度

1. 处理中断过程中
2. 进程在操作系统内核程序临界区中
3. 原子操作过程中（原语）

#### 进程切换与过程

1. 进程的**切换**在**调度**完成之后立刻发生
2. 切换的过程
   - 对原进程的现场信息压入当前进程的内核堆栈进行保存，并更新堆栈指针
   - 从新进程的内核栈中装入新进程的现场信息（更新当前进程的空间指针、重设PC寄存器等）
3. 进程的调度、切换是有代价的，并非调度越频繁并发度越高

#### 进程调度的方式

1. 非剥夺式调度（非抢占式）：只能由当前进程主动放弃CPU
2. 剥夺式调度（抢占式）：可由操作系统剥夺当前进程的CPU使用权

---

### 调度算法的评测标准

1. CPU利用率
   - $\begin{aligned}
      CPU利用率=\frac{CPU运行时间}{总时间}
   \end{aligned}$

2. 系统吞吐量
   - $\begin{aligned}
      系统吞吐量=\frac{总共完成的作业数}{总共消耗的时间}
   \end{aligned}$

3. 周转时间
   - $\begin{aligned}
      周转时间=作业完成时间-作业提交时间
   \end{aligned}$

   - $\begin{aligned}
      平均周转时间=\frac{各作业周转时间之和}{作业数}
   \end{aligned}$
  
   - $\begin{aligned}
      带权周转时间=\frac{作业周转时间}{作业实际运行时间}
   \end{aligned}$
  
   - $\begin{aligned}
      平均带权周转时间=\frac{各作业带权周转时间之和}{作业数}
   \end{aligned}$

4. 等待时间
   - $进程/作业等待时间=等待被服务的时间之和$
   - $进程/作业平均等待时间=各进程/作业等待时间的平均值$
  
5. 响应时间
   - $响应时间=首次响应时间-用户提交请求时间$

---

### 调度算法

#### 先来先服务(FCFS)调度算法

1. 算法思想：“公平”，先到的进程/作业优先服务
2. 算法规则：按照进程/作业到达的先后顺序进行服务
3. 用于进程/作业调度
   - 在进程调度中，挑选最先进入就绪队列的进程
   - 在作业调度中，挑选最先进入后备队列的作业
4. 是否可抢占：不可抢占
5. 优缺点：
   - 优点：公平，实现简单
   - 缺点：效率低；对长作业有利，段作业不利；对CPU繁忙型作业有利；对IO繁忙型作业不利；带权周转时间大
6. 是否会导致饥饿：否

#### 短作业优先（SJF）调度算法

1. 算法思想：追求最少的平均等待时间、平均周转时间、平均带权周转时间
2. 算法规则：最短的进程/作业优先得到服务（要求服务时间最短）
3. 用于进程/作业调度：
   - 可用于进程调度，在进程调度中也称为短进程（SPF）优先调度算法
   - 可用于作业调度
4. 是否可抢占：不可抢占，但有可抢占式的版本，即最短剩余时间（SRTN）优先算法
5. 优缺点：
   - 优点：“最短的”平均等待时间、平均周转时间
   - 缺点：对短作业有利，长作业不利，可能出现饥饿现象；作业的运行时间的长短是由用户提供的，并不一定真实，不能做到真正的短作业优先；未考虑到作业的紧迫程度，不能保证及时处理紧迫的作业
6. 是否会导致饥饿：会，当有源源不断的短作业到来，长作业会长时间得不到服务，从而产生饥饿现象
7. 补充
   - 若题中未特别指明抢占式,则默认为SJF算法
   - 在所有进程同时到达（或同时可运行）时，SJF算法的平均等待时间、平均周转时间最少，否则SRTN算法（**抢占式**短进程/作业调度算法）的平均等待时间、平均周转时间最少

#### 高响应比优先（HRRN）调度算法

1. 算法思想：综合考虑进程/作业的等待时间和要求服务时间
2. 算法规则：在每次调度时先计算各个作业的响应比，选择响应比最高的作业进行调度  
3. 用于进程/作业调度：
   - 可用于进程调度
   - 可用于作业调度
4. 是否可抢占：非抢占式算法,只有当当前运行的作业/进程主动放弃CPU时，才需要调度，并计算响应比
5. 优缺点：
   - 作业等待时间相同时，要求服务时间越短，响应比越高，有利于短作业（SJF优点）
   - 要求服务时间相等时，等待时间越长，响应比越高，有利于长时间等待的作业（FCFS优点）
   - 对于长作业，响应比随等待时间的增加而增加，避免了长作业出现饥饿的现象（解决SJF的缺点）
   - 无明显缺点
6. 是否会导致饥饿：不会
7. 响应比公式
   - $\begin{aligned}
   响应比=\frac{等待时间+要求服务时间}{要求服务时间}（响应比 \geq 1）
\end{aligned}$

#### 优先级调度算法

1. 算法思想：需要根据进程的紧迫程度确定进程的执行顺序，如实时操作系统
2. 算法规则：选择优先级最高的进程\作业进行调度
3. 用于进程/作业调度：
   - 可用于进程调度
   - 可用于作业调度
   - IO调度中也可使用
4. 是否可抢占：抢占式、非抢占式皆可，区别只在于，对于非抢占而言，调度只发生在进程主动放弃处理机时；对于抢占式而言，当就绪队列发生变化，需检查是否发生抢占
5. 优缺点：
   - 优点：用优先级区分作业的紧迫程度，适用于实时操作系统，可以灵活的调整不同作业的偏好程度
   - 缺点：可能导致饥饿现象，当有源源不断的高优先级任务到达时，低优先级的作业可能长时间得不到调度，产生饥饿现象
6. 是否会导致饥饿：会
7. 根据优先级是否可变可分为：
   - 静态优先级：创建时确定，之后不可改变
   - 动态优先级：创建时有初值，之后根据情况动态调整
8. 优先级设置的原则参考：
   - 系统进程 > 用户进程
   - 交互型进程 > 非交互型进程（或前台进程 > 后台进程）
   - IO型进程 > 计算型进程

#### 时间片轮转（RR）调度算法

1. 算法思想：公平的、轮流的为各个进程服务，让每个进程在一定时间间隔内都能得到响应
2. 算法规则：按照各进程到达就绪队列的顺序，轮流的让进程在一个时间片（如100ms）上运行，若进程未在一个时间片内执行完，则剥夺处理机，将进程重新放到就绪队列队尾
3. 用于进程/作业调度：
   - 只用于进程调度
   - 不可用于作业调度（只有作业调入内存并创建相应进程后，才能被分配处理机时间片）
4. 是否可抢占：抢占式算法，若进程未在一个时间片内执行完，则强行剥夺处理机的使用权，由时钟装置发出时钟中断来通知CPU的时间片到
5. 优缺点：
   - 优点：公平；响应快，适用于分时操作系统
   - 缺点：若时间片过大（进程能在一个时间片内完成），则时间片轮转调度算法退化为FCFS算法；若时间片过小，由于高频率的切换进程，导致开销增大；不区分任务的紧迫程度
6. 是否会导致饥饿：不会
7. 补充：时间片的长短通常由以下因素确定：系统响应时间、就绪队列中的进程数、系统的处理能力

#### 多级反馈队列调度算法

1. 算法思想：对各算法的综合、折中的考虑
2. 算法规则：
   - 设置多级就绪队列，优先级由高到低，时间片由短到长（即第1级队列的优先级最高，时间片最短，其余队列的优先级逐级递减，时间片逐级递加）
   - 一个新进程到达时，首先进入第1级队列的队尾，按FCFS原则排队等待调度，若时间片用完，该进程还未执行完成，则进程进入第2级队列的队尾，按FCFS原则排队等待调度，当进程处在最下一级队列中时，则重新放回该级队列队尾
   - 只有（1~k）级队列为空时，才会开始对第k+1级中的进程进行调度
   - 当处理机正在执行第i级队列中的进程调度时，若有新进程进入优先级更高的队列（第1~i-1级队列任意一个）中，则此时新进程将抢占处理机
3. 用于进程/作业调度：
   - 仅用于进程调度
   - 不可用于作业调度
4. 是否可抢占：抢占式算法
5. 优缺点：
   优点：对各类进程比较公平（FCFS优点）；每个新到达的进程都可以很快得到相应（RR优点）；短进程只需较少时间就可完成（SPF优点）；不用提供进程的运行时间（SPF缺点，即用户对运行时间作假）；
   可灵活的调整对各类进程的偏好程度，如CPU繁忙型、IO繁忙型（可以将因IO阻塞的进程重新放回原队列，这样IO繁忙型进程就能保持较高优先级）
   缺点：在比较特殊的情况下可能出现饥饿现象，如若短进程能在较短时间片完成，当短进程源源不断到来时，有可能会使处在低级队列中的进程出现饥饿现象
6. 是否会导致饥饿：会

---

### 对各调度算法的总结

| 算法 | 进程or作业 |是否可抢占 | 优点 | 缺点 | 是否发生饥饿 | 补充 |
|:---:|:---:|:--------:|:----:|:---:|:----------:|:----:|
| 先来先服务调度算法 | 进程作业皆可 | 非抢占式 | 公平，实现简单 | 对短作业不利 | 不会 | 考虑等待时间，未考虑运行时间
| 短作业优先调度算法 | 进程作业皆可 |默认非抢占式，也存在抢占式算法，即最短剩余时间算法（SRTN）| “最短”平均等待时间、平均周转时间 | 对长作业不利；可能导致饥饿；难以做到真正的短作业优先（运行时间用户作假）| 会 | 未考虑等待时间，考虑运行时间|
| 高响应比优先调度算法 |进程作业皆可 | 非抢占式 | 上述两种算法的优点的结合 | | 不会| 考虑等待时间，考虑运行时间|
| 优先级调度算法 | 进程作业皆可 |有抢占式也有非抢占式 | 区分优先级，适用于实时操作系统 | 可能导致饥饿 | 会 | 动态/静态优先级。如何设置优先级 |
| 时间片轮转调度算法 | 只进程 |抢占式 | 公平，适用于分时操作系统 | 频繁切换有开销，不区分优先级 | 不会| 时间片过大、过小分别有何影响 |
| 多级反馈队列调度算法 | 只进程 |抢占式 | 均衡，融合了前几种算法的优点 | 几乎无缺点，可能导致饥饿 | 会 | | 